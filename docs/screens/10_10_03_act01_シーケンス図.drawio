<mxfile host="65bd71144e" modified="2025-01-01T00:00:00.000Z" agent="draw.io" version="22.1.16" etag="seq-10_10_03_act01" type="device">
    <diagram id="seq-10_10_03_act01" name="認証状態チェック">
        <mxGraphModel dx="1000" dy="700" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>

                <mxCell id="swimlane-user" value="ユーザー" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
                    <mxGeometry x="100" y="100" width="200" height="700" as="geometry"/>
                </mxCell>
                <mxCell id="user-lifeline" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#6c8ebf;" vertex="1" parent="swimlane-user">
                    <mxGeometry y="40" width="200" height="660" as="geometry"/>
                </mxCell>

                <mxCell id="swimlane-router" value="ルーター&#xa;(認証ガード)" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
                    <mxGeometry x="350" y="100" width="300" height="700" as="geometry"/>
                </mxCell>
                <mxCell id="router-lifeline" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#d6b656;strokeDashArray=2 2;" vertex="1" parent="swimlane-router">
                    <mxGeometry y="40" width="300" height="660" as="geometry"/>
                </mxCell>

                <mxCell id="swimlane-api" value="バックエンドAPI&#xa;(オプション)" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
                    <mxGeometry x="700" y="100" width="250" height="700" as="geometry"/>
                </mxCell>
                <mxCell id="api-lifeline" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#d79b00;strokeDashArray=2 2;" vertex="1" parent="swimlane-api">
                    <mxGeometry y="40" width="250" height="660" as="geometry"/>
                </mxCell>

                <mxCell id="swimlane-protected" value="保護されたページ&#xa;(フロントエンド)" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
                    <mxGeometry x="1000" y="100" width="200" height="700" as="geometry"/>
                </mxCell>
                <mxCell id="protected-lifeline" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#82b366;strokeDashArray=2 2;" vertex="1" parent="swimlane-protected">
                    <mxGeometry y="40" width="200" height="660" as="geometry"/>
                </mxCell>

                <mxCell id="swimlane-login" value="ログインページ&#xa;(フロントエンド)" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
                    <mxGeometry x="1250" y="100" width="200" height="700" as="geometry"/>
                </mxCell>
                <mxCell id="login-lifeline" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=#b85450;strokeDashArray=2 2;" vertex="1" parent="swimlane-login">
                    <mxGeometry y="40" width="200" height="660" as="geometry"/>
                </mxCell>

                <mxCell id="msg-access" value="保護されたページのURLにアクセス&#xa;(例: /profile)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="user-lifeline" target="router-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="200" y="200"/>
                            <mxPoint x="500" y="200"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="activation-router-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;opacity=30;" vertex="1" parent="1">
                    <mxGeometry x="360" y="180" width="280" height="500" as="geometry"/>
                </mxCell>

                <mxCell id="note-start" value="認証状態チェック開始" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
                    <mxGeometry x="370" y="190" width="150" height="40" as="geometry"/>
                </mxCell>

                <mxCell id="msg-token-check" value="認証トークン確認&#xa;(localStorage/sessionStorage)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;endArrow=classic;startArrow=classic;" edge="1" parent="1" source="router-lifeline" target="router-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="500" y="260"/>
                            <mxPoint x="580" y="260"/>
                            <mxPoint x="580" y="280"/>
                            <mxPoint x="500" y="280"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="branch-no-token" value="トークン不存在" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=center;" vertex="1" parent="1">
                    <mxGeometry x="420" y="320" width="120" height="80" as="geometry"/>
                </mxCell>

                <mxCell id="msg-save-url" value="元のURLを保持&#xa;(redirectパラメータ)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;endArrow=classic;startArrow=classic;" edge="1" parent="1" source="router-lifeline" target="router-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="500" y="440"/>
                            <mxPoint x="580" y="440"/>
                            <mxPoint x="580" y="460"/>
                            <mxPoint x="500" y="460"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="msg-redirect" value="ログインページにリダイレクト&#xa;(/login?redirect=/profile)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#b85450;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="router-lifeline" target="login-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="500" y="520"/>
                            <mxPoint x="1350" y="520"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="activation-login-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;opacity=30;" vertex="1" parent="1">
                    <mxGeometry x="1260" y="500" width="180" height="40" as="geometry"/>
                </mxCell>

                <mxCell id="msg-login-display" value="ログインページ表示" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="login-lifeline" target="user-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="1350" y="560"/>
                            <mxPoint x="200" y="560"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="branch-token-exists" value="トークン存在" style="rhombus;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=center;" vertex="1" parent="1">
                    <mxGeometry x="420" y="580" width="120" height="80" as="geometry"/>
                </mxCell>

                <mxCell id="opt-token-verify" value="トークン有効性確認（オプション）" style="shape=umlFrame;whiteSpace=wrap;html=1;width=30;height=30;align=center;verticalAlign=top;spacingLeft=10;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
                    <mxGeometry x="430" y="700" width="200" height="140" as="geometry"/>
                </mxCell>

                <mxCell id="msg-api-me" value="GET /api/auth/me&#xa;(Authorization: Bearer token)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="router-lifeline" target="api-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="500" y="760"/>
                            <mxPoint x="825" y="760"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="activation-api-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;opacity=30;" vertex="1" parent="1">
                    <mxGeometry x="710" y="740" width="230" height="80" as="geometry"/>
                </mxCell>

                <mxCell id="branch-token-invalid" value="トークン無効・期限切れ" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=center;" vertex="1" parent="1">
                    <mxGeometry x="720" y="860" width="120" height="80" as="geometry"/>
                </mxCell>

                <mxCell id="msg-api-error" value="401 Unauthorized" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#b85450;strokeDashArray=5 5;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="api-lifeline" target="router-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="825" y="960"/>
                            <mxPoint x="500" y="960"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="msg-redirect-expired" value="ログインページにリダイレクト&#xa;(期限切れ通知)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#b85450;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="router-lifeline" target="login-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="500" y="1020"/>
                            <mxPoint x="1350" y="1020"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="msg-login-expired" value="ログインページ表示&#xa;(期限切れメッセージ)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="login-lifeline" target="user-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="1350" y="1080"/>
                            <mxPoint x="200" y="1080"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="branch-token-valid" value="トークン有効" style="rhombus;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=center;" vertex="1" parent="1">
                    <mxGeometry x="720" y="980" width="120" height="80" as="geometry"/>
                </mxCell>

                <mxCell id="msg-api-success" value="200 OK&#xa;{success: true, user: {...}}" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#82b366;strokeDashArray=5 5;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="api-lifeline" target="router-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="825" y="1100"/>
                            <mxPoint x="500" y="1100"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="msg-allow" value="ページ表示許可" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="router-lifeline" target="protected-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="500" y="1160"/>
                            <mxPoint x="1100" y="1160"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="activation-protected-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=30;" vertex="1" parent="1">
                    <mxGeometry x="1010" y="1140" width="180" height="40" as="geometry"/>
                </mxCell>

                <mxCell id="msg-display" value="保護されたページ表示" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="protected-lifeline" target="user-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="1100" y="1200"/>
                            <mxPoint x="200" y="1200"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="alt-simple" value="トークン存在のみで許可（簡易チェック）" style="shape=umlFrame;whiteSpace=wrap;html=1;width=30;height=30;align=center;verticalAlign=top;spacingLeft=10;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
                    <mxGeometry x="430" y="1200" width="200" height="100" as="geometry"/>
                </mxCell>

                <mxCell id="msg-allow-simple" value="ページ表示許可" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="router-lifeline" target="protected-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="500" y="1280"/>
                            <mxPoint x="1100" y="1280"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="msg-display-simple" value="保護されたページ表示" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#666666;labelBackgroundColor=#ffffff;fontSize=11;" edge="1" parent="1" source="protected-lifeline" target="user-lifeline">
                    <mxGeometry x="0" y="0" width="50" height="50" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                        <Array as="points">
                            <mxPoint x="1100" y="1320"/>
                            <mxPoint x="200" y="1320"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>

