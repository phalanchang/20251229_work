# ダッシュボード 詳細設計書

## 1. 画面情報

| 項目 | 内容 |
|------|------|
| 画面ID | `10_10_02` |
| 画面名 | ダッシュボード |
| 旧画面ID | `SCR-002` |
| URL | `/dashboard` または `/` |
| 認証 | 必要（未ログインの場合はログインページにリダイレクト） |
| 優先度 | 高 |

## 2. 画面概要

### 2.1 目的
ログイン後のメイン画面。ユーザーがアプリケーションの主要機能にアクセスするための画面

### 2.2 主要な要素

| 要素名 | 種類 | 説明 | 必須 |
|--------|------|------|------|
| ヘッダー | レイアウト要素 | アプリケーションのヘッダー部分 | ○ |
| ユーザー情報表示 | テキスト | ログイン中のユーザー名やメールアドレス | ○ |
| ログアウトボタン | ボタン | ログアウト処理を実行 | ○ |
| メインコンテンツエリア | レイアウト要素 | アプリケーションの主要コンテンツ | ○ |
| ナビゲーションメニュー | メニュー | 他のページへのリンク（オプション） | - |

## 3. 画面状態

### 3.1 初期状態（ロード中）
- データ取得中
- ローディングインジケーターを表示

### 3.2 表示状態
- データ取得完了
- コンテンツを表示

### 3.3 ログアウト処理中
- ログアウトボタンクリック後
- ローディングインジケーターを表示（オプション）

### 3.4 セッション期限切れ状態
- セッションが期限切れの場合
- 自動的にログインページにリダイレクト
- 期限切れ通知を表示（オプション）

## 4. アクション一覧

### 4.1 アクション一覧表

| アクションID | アクション名 | トリガー | 遷移先 | 備考 |
|-------------|-------------|---------|--------|------|
| 10_10_02_act01 | ログアウト | ログアウトボタンクリック | ログインページ（`10_10_01`） | ログアウト処理を実行 |
| 10_10_02_act02 | 保護されたページへの遷移 | リンククリックなど | 保護されたページ（`10_10_03`） | 保護されたページへのアクセス |

### 4.2 アクション詳細

#### 10_10_02_act01: ログアウト

**アクションID**: `10_10_02_act01`  
**アクション名**: ログアウト  
**トリガー**: ログアウトボタンクリック

**処理フロー**:
1. ログアウト確認（オプション）
   - 確認ダイアログを表示（実装による）
2. APIリクエスト送信
   - `POST /api/auth/logout`
   - 認証トークンを含む
3. セッション無効化
   - サーバー側でセッションを無効化
4. トークン削除
   - クライアント側の認証トークンを削除
5. リダイレクト
   - ログインページ（`10_10_01`）にリダイレクト

**遷移先**: ログインページ（`10_10_01`）

**エラーハンドリング**:
- ネットワークエラー: エラーメッセージを表示し、ローカルのトークンを削除してログインページにリダイレクト
- サーバーエラー: 同様に処理

#### 10_10_02_act02: 保護されたページへの遷移

**アクションID**: `10_10_02_act02`  
**アクション名**: 保護されたページへの遷移  
**トリガー**: リンククリック、メニュー選択など

**処理フロー**:
1. 保護されたページのURLにアクセス
2. 認証状態チェックが自動的に実行される（ルーター側）
3. ログイン済みの場合、保護されたページを表示

**遷移先**: 保護されたページ（`10_10_03`）

## 5. 画面遷移

### 5.1 遷移元

| 遷移元画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| 認証状態チェック | ログイン済み | アプリ起動時、ログイン済みの場合 |
| 認証結果 | 認証成功 | ログイン成功時 |

### 5.2 遷移先

| 遷移先画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| ログインページ | ログアウト | ログアウトボタンクリック時 |
| 保護されたページ | リンククリックなど | 保護されたページへのアクセス |

## 6. API仕様

### 6.1 ログアウトAPI

- **エンドポイント**: `POST /api/auth/logout`
- **認証**: 必要（JWTトークンまたはセッション）
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "success": true,
    "message": "ログアウトしました"
  }
  ```

### 6.2 認証状態確認API

- **エンドポイント**: `GET /api/auth/me`
- **認証**: 必要（JWTトークンまたはセッション）
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "success": true,
    "user": {
      "id": 1,
      "email": "user@example.com",
      "username": "username"
    }
  }
  ```
- **レスポンス（未認証）**: `401 Unauthorized`
  ```json
  {
    "success": false,
    "message": "認証が必要です"
  }
  ```

## 7. 備考

- 未ログインの状態でこのページにアクセスした場合、自動的にログインページにリダイレクト
- セッション期限切れ時も自動的にログインページにリダイレクト
- メインコンテンツエリアには、アプリケーションの主要機能へのアクセスを提供

