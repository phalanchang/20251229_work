# ログインページ 詳細設計書

## 1. 画面情報

| 項目 | 内容 |
|------|------|
| 画面ID | `10_10_01` |
| 画面名 | ログインページ |
| 旧画面ID | `SCR-001` |
| URL | `/login` |
| 認証 | 不要（ただし、ログイン済みの場合はダッシュボードにリダイレクト） |
| 優先度 | 高 |

## 2. 画面概要

### 2.1 目的
ユーザーが認証情報を入力してログインするための画面

### 2.2 主要な要素

| 要素名 | 種類 | 説明 | 必須 |
|--------|------|------|------|
| ページタイトル | テキスト | 「ログイン」またはアプリケーション名 | ○ |
| メールアドレス入力欄 | 入力フィールド | メールアドレス（またはユーザー名）を入力 | ○ |
| パスワード入力欄 | 入力フィールド | パスワードを入力（マスク表示） | ○ |
| パスワード表示/非表示切り替え | ボタン | パスワードの表示/非表示を切り替え（オプション） | - |
| ログインボタン | ボタン | ログイン処理を実行 | ○ |
| エラーメッセージ表示エリア | テキスト | ログイン失敗時のエラーメッセージを表示 | - |
| ローディングインジケーター | UI要素 | ログイン処理中の表示 | - |
| 入力検証エラーメッセージ | テキスト | 各入力欄の検証エラーメッセージ | - |

## 3. 画面状態

### 3.1 初期状態
- すべての入力欄が空
- エラーメッセージは非表示
- ログインボタンは有効

### 3.2 入力中
- ユーザーが入力欄に入力中
- リアルタイムで入力検証を実行（オプション）

### 3.3 検証エラー状態
- 入力検証に失敗した場合
- 該当する入力欄の下にエラーメッセージを表示
- ログインボタンは無効化（またはクリック時にエラー表示）

### 3.4 ログイン処理中
- ログインボタンをクリック後、APIリクエスト送信中
- ローディングインジケーターを表示
- ログインボタンは無効化

### 3.5 ログイン失敗状態
- 認証に失敗した場合
- エラーメッセージ表示エリアにエラーメッセージを表示
- パスワード入力欄をクリア
- メールアドレス入力欄は保持
- ログインボタンは再度有効化

### 3.6 ログイン成功状態
- 認証に成功した場合
- ダッシュボード（または元のページ）にリダイレクト
- 成功通知を表示（オプション）

## 4. 入力検証ルール

| 項目 | 検証ルール | エラーメッセージ例 |
|------|-----------|-------------------|
| メールアドレス | 必須、有効なメールアドレス形式 | 「メールアドレスを入力してください」「有効なメールアドレス形式で入力してください」 |
| パスワード | 必須、最小文字数（例：8文字以上） | 「パスワードを入力してください」「パスワードは8文字以上で入力してください」 |

## 5. アクション一覧

### 5.1 アクション一覧表

| アクションID | アクション名 | トリガー | 遷移先 | 備考 |
|-------------|-------------|---------|--------|------|
| 10_10_01_act01 | 認証情報入力・検証・認証処理 | ログインボタンクリック | 認証結果（分岐） | 認証情報入力、入力検証、認証処理を実行 |

### 5.2 アクション詳細

#### 10_10_01_act01: 認証情報入力・検証・認証処理

**アクションID**: `10_10_01_act01`  
**アクション名**: 認証情報入力・検証・認証処理  
**トリガー**: ログインボタンクリック

**処理フロー**:
1. 認証情報入力
   - ユーザーがメールアドレスとパスワードを入力
2. 入力検証
   - クライアント側で入力検証を実行
   - 検証エラーがある場合は、エラーメッセージを表示して処理を中断
3. 認証処理
   - APIリクエスト送信: `POST /api/auth/login`
   - リクエストボディ: `{ "email": "...", "password": "..." }`
   - レスポンス待機中はローディングインジケーターを表示

**遷移先**:
- 認証成功: ダッシュボード（`10_10_02`）または元のページ
- 認証失敗: ログインページ（`10_10_01`）に留まり、エラーメッセージを表示

**エラーハンドリング**:
- 認証失敗: 「メールアドレスまたはパスワードが正しくありません」を表示
- ネットワークエラー: 「通信エラーが発生しました。再度お試しください」を表示
- サーバーエラー: 「システムエラーが発生しました。しばらくしてから再度お試しください」を表示

## 6. 画面遷移

### 6.1 遷移元

| 遷移元画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| 認証状態チェック | 未ログイン | アプリ起動時、未ログインの場合 |
| 認証結果 | 認証失敗 | 認証失敗時、エラー表示 |
| ダッシュボード | ログアウト | ログアウトボタンクリック時 |
| 認証状態チェック（保護ページ） | 未ログイン | 保護されたページアクセス時、未ログインの場合 |

### 6.2 遷移先

| 遷移先画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| 認証結果 | ログインボタンクリック | 認証情報入力・検証・認証処理実行 |
| ダッシュボード | 認証成功 | 認証成功時（認証結果から遷移） |

## 7. API仕様

### 7.1 ログインAPI

- **エンドポイント**: `POST /api/auth/login`
- **リクエストボディ**:
  ```json
  {
    "email": "user@example.com",
    "password": "password123"
  }
  ```
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "success": true,
    "token": "jwt_token_here",
    "user": {
      "id": 1,
      "email": "user@example.com",
      "username": "username"
    }
  }
  ```
- **レスポンス（失敗）**: `401 Unauthorized`
  ```json
  {
    "success": false,
    "message": "メールアドレスまたはパスワードが正しくありません"
  }
  ```

## 8. アクセシビリティ要件

- すべての入力欄に適切なラベルを設定
- エラーメッセージは適切なARIA属性で関連付け
- キーボード操作で全機能にアクセス可能
- フォーカス順序が論理的

## 9. 備考

- ログイン済みの状態でこのページにアクセスした場合、自動的にダッシュボードにリダイレクト
- パスワード入力欄はマスク表示をデフォルトとする
- パスワード表示/非表示の切り替え機能は、セキュリティとユーザビリティのバランスを考慮して実装

