# 保護されたページ 詳細設計書

## 1. 画面情報

| 項目 | 内容 |
|------|------|
| 画面ID | `10_10_03` |
| 画面名 | 保護されたページ |
| 旧画面ID | `SCR-003` |
| URL | `/protected/*`（例：`/profile`, `/settings`など） |
| 認証 | 必要（未ログインの場合はログインページにリダイレクト） |
| 優先度 | 中 |

## 2. 画面概要

### 2.1 目的
認証が必要な任意のページの例。プロフィールページ、設定ページなど

### 2.2 主要な要素

| 要素名 | 種類 | 説明 | 必須 |
|--------|------|------|------|
| ヘッダー | レイアウト要素 | アプリケーションのヘッダー部分 | ○ |
| ログアウトボタン | ボタン | ログアウト処理を実行 | ○ |
| ページ固有のコンテンツ | レイアウト要素 | ページごとのコンテンツ | ○ |

## 3. 画面状態

### 3.1 未認証アクセス時
- 認証チェックで未ログインが検出される
- ログインページにリダイレクト
- 元のURLを保持（リダイレクト先として）

### 3.2 認証済みアクセス時
- 認証チェックを通過
- ページコンテンツを表示

## 4. アクション一覧

### 4.1 アクション一覧表

| アクションID | アクション名 | トリガー | 遷移先 | 備考 |
|-------------|-------------|---------|--------|------|
| 10_10_03_act01 | 認証状態チェック | ページアクセス時 | 認証状態チェック（分岐） | 自動的に実行される |

### 4.2 アクション詳細

#### 10_10_03_act01: 認証状態チェック

**アクションID**: `10_10_03_act01`  
**アクション名**: 認証状態チェック  
**トリガー**: ページアクセス時（自動実行）

**処理フロー**:
1. ページアクセス
   - ユーザーが保護されたページのURLにアクセス
2. 認証状態チェック
   - ルーター側で認証状態をチェック
   - 認証トークンまたはセッションの有効性を確認
3. 分岐処理
   - ログイン済み: ページを表示
   - 未ログイン: ログインページにリダイレクト（元のURLを保持）

**遷移先**:
- ログイン済み: 保護されたページ（`10_10_03`）に留まり、ページ表示
- 未ログイン: ログインページ（`10_10_01`）にリダイレクト

**エラーハンドリング**:
- 認証トークンが無効: ログインページにリダイレクト
- セッション期限切れ: ログインページにリダイレクト（期限切れ通知を表示）

## 5. 画面遷移

### 5.1 遷移元

| 遷移元画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| ダッシュボード | リンククリックなど | 保護されたページへのアクセス |
| 認証状態チェック | ログイン済み | 認証状態チェック後、ログイン済みの場合 |

### 5.2 遷移先

| 遷移先画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| 認証状態チェック | ページアクセス時 | 自動的に認証状態チェックが実行される |
| ログインページ | 未ログイン | 認証状態チェックで未ログインが検出された場合 |

## 6. リダイレクト処理

### 6.1 未ログイン時のリダイレクト

1. ユーザーが保護されたページ（例：`/profile`）にアクセス
2. 認証チェックで未ログインを検出
3. `/login?redirect=/profile` にリダイレクト
4. ログイン成功後、`/profile` にリダイレクト

### 6.2 URLパラメータ

- `redirect`: リダイレクト先のURLを保持
- 例: `/login?redirect=/profile`

## 7. 備考

- このページは、プロフィールページ、設定ページなど、認証が必要な任意のページのテンプレートとして使用
- 各ページ固有のコンテンツは、ページごとに定義
- 認証状態チェックは、ルーター側で自動的に実行される想定

