# 10_10_02_act01: ログアウト シーケンス図

## アクション情報

| 項目 | 内容 |
|------|------|
| アクションID | `10_10_02_act01` |
| アクション名 | ログアウト |
| 画面ID | `10_10_02`（ダッシュボード） |
| トリガー | ログアウトボタンクリック |

## シーケンス図

```mermaid
sequenceDiagram
    participant User as ユーザー
    participant UI as ダッシュボード<br/>(フロントエンド)
    participant Router as ルーター
    participant API as バックエンドAPI
    participant Session as セッション管理

    User->>UI: ログアウトボタンクリック
    
    opt ログアウト確認（オプション）
        UI->>User: 確認ダイアログ表示
        User->>UI: 確認/キャンセル
        
        alt キャンセル
            UI->>User: 処理中断
        else 確認
            Note over UI: ログアウト処理開始
        end
    end
    
    UI->>UI: ローディングインジケーター表示<br/>(オプション)
    UI->>API: POST /api/auth/logout<br/>(Authorization: Bearer token)
    
    Note over API: セッション無効化
    
    API->>Session: セッション無効化<br/>(トークン削除)
    Session-->>API: 無効化完了
    
    alt ネットワークエラー
        API-->>UI: エラー
        Note over UI: エラー時もローカル処理を実行
    else 正常
        API-->>UI: 200 OK<br/>{success: true, message: "ログアウトしました"}
    end
    
    UI->>UI: ローカルのトークン削除<br/>(localStorage/sessionStorage)
    UI->>Router: ログインページにリダイレクト
    Router->>User: ログインページ表示
```

## 処理フロー詳細

### 1. ログアウト確認（オプション）
- 確認ダイアログを表示（実装による）
- キャンセルした場合、処理を中断

### 2. APIリクエスト送信
- `POST /api/auth/logout`
- 認証トークンをヘッダーに含める
- ローディングインジケーターを表示（オプション）

### 3. セッション無効化（サーバー側）
- サーバー側でセッションを無効化
- トークンを削除

### 4. クライアント側処理
- ローカルの認証トークンを削除
- ログインページにリダイレクト

## エラーハンドリング

| エラー種別 | 処理 |
|-----------|------|
| ネットワークエラー | エラーメッセージを表示し、ローカルのトークンを削除してログインページにリダイレクト |
| サーバーエラー | 同様に処理（ローカルのトークンを削除してログインページにリダイレクト） |

## 備考

- エラーが発生した場合でも、ローカルのトークンは削除する
- これにより、クライアント側の認証状態を確実にクリアできる
- ログアウト確認ダイアログは、実装によっては省略可能

