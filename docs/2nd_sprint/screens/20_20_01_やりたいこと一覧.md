# やりたいこと一覧 詳細設計書

## 1. 画面情報

| 項目 | 内容 |
|------|------|
| 画面ID | `20_20_01` |
| 画面名 | やりたいこと一覧 |
| 旧画面ID | `SCR-005` |
| URL | `/dashboard`（サイドバーで「やりたいこと」を選択） |
| 認証 | 必要（未ログインの場合はログインページにリダイレクト） |
| 優先度 | 高 |

## 2. 画面概要

### 2.1 目的
ユーザーが「やりたいこと」を管理するための画面。リスト表示、タグフィルター、新規登録、編集機能を提供。

### 2.2 主要な要素

| 要素名 | 種類 | 説明 | 必須 |
|--------|------|------|------|
| ページタイトル | テキスト | 「やりたいこと」 | ○ |
| 新規登録ボタン | ボタン | 新規登録フォームを開く | ○ |
| タグフィルター | UI要素 | タグごとに表示/非表示を切り替え | ○ |
| やりたいことテーブル | テーブル | やりたいことのリストを表示 | ○ |
| 新規登録フォーム | ダイアログ | 新規登録用のフォーム | - |
| 詳細・編集ダイアログ | ダイアログ | 詳細表示・編集用のフォーム | - |

### 2.3 テーブルカラム

| カラム名 | 説明 | 表示内容 |
|---------|------|---------|
| No. | 番号 | 連番（ID） |
| タイトル | やりたいことのタイトル | クリック可能（詳細表示） |
| URL | 関連URL | 外部リンクとして表示（新しいタブで開く） |
| ステータス | ステータス | 未着手/進行中/完了（バッジ表示） |
| 登録日 | 登録日 | YYYY-MM-DD形式 |
| 更新日 | 更新日 | YYYY-MM-DD形式 |
| タグ | タグ | 複数タグをバッジ形式で表示 |
| 優先度 | 優先度 | 高/中/低（バッジ表示） |

## 3. 画面状態

### 3.1 初期状態
- すべてのやりたいことが表示される
- タグフィルターは未選択
- 新規登録フォームは非表示
- 詳細・編集ダイアログは非表示

### 3.2 タグフィルター適用時
- 選択されたタグを含むやりたいことのみ表示
- フィルター解除ボタンが表示される
- 該当するデータがない場合は「該当するデータがありません」を表示

### 3.3 新規登録フォーム表示時
- モーダルダイアログで新規登録フォームを表示
- 背景は半透明のオーバーレイ
- フォームの入力欄は空

### 3.4 詳細・編集ダイアログ表示時
- モーダルダイアログで詳細・編集フォームを表示
- 既存のデータがフォームに表示される
- 更新ボタンをクリックすると更新処理を実行

## 4. 入力検証ルール

| 項目 | 検証ルール | エラーメッセージ例 |
|------|-----------|-------------------|
| タイトル | 必須 | 「タイトルを入力してください」 |
| URL | 必須、有効なURL形式（http://またはhttps://で始まる） | 「URLを入力してください」「有効なURLを入力してください（http://またはhttps://で始まる）」 |
| タグ | 必須 | 「タグを入力してください」 |
| ステータス | 必須（未着手/進行中/完了） | - |
| 優先度 | 必須（高/中/低） | - |
| メモ | 任意 | - |

## 5. アクション一覧

### 5.1 アクション一覧表

| アクションID | アクション名 | トリガー | 遷移先 | 備考 |
|-------------|-------------|---------|--------|------|
| 20_20_01_act01 | タグフィルター切り替え | タグボタンクリック | やりたいこと一覧（フィルター適用） | タグごとに表示/非表示を切り替え |
| 20_20_01_act02 | 新規登録フォーム表示 | 新規登録ボタンクリック | 新規登録フォーム表示 | モーダルダイアログで表示 |
| 20_20_01_act03 | 新規登録 | 新規登録フォーム送信 | やりたいこと一覧（更新） | データベースに登録 |
| 20_20_01_act04 | 詳細表示 | タイトルクリック | 詳細・編集ダイアログ表示 | モーダルダイアログで表示 |
| 20_20_01_act05 | 更新 | 更新ボタンクリック | やりたいこと一覧（更新） | データベースを更新 |

### 5.2 アクション詳細

#### 20_20_01_act01: タグフィルター切り替え

**アクションID**: `20_20_01_act01`  
**アクション名**: タグフィルター切り替え  
**トリガー**: タグボタンクリック

**処理フロー**:
1. タグボタンをクリック
2. 選択状態を切り替え（選択→未選択、未選択→選択）
3. 選択されたタグを含むやりたいことのみ表示
4. すべてのタグが未選択の場合は、すべてのやりたいことを表示

**遷移先**: やりたいこと一覧（フィルター適用）

#### 20_20_01_act02: 新規登録フォーム表示

**アクションID**: `20_20_01_act02`  
**アクション名**: 新規登録フォーム表示  
**トリガー**: 新規登録ボタンクリック

**処理フロー**:
1. 新規登録ボタンをクリック
2. モーダルダイアログで新規登録フォームを表示
3. フォームの入力欄は空

**遷移先**: 新規登録フォーム表示（モーダル）

#### 20_20_01_act03: 新規登録

**アクションID**: `20_20_01_act03`  
**アクション名**: 新規登録  
**トリガー**: 新規登録フォーム送信

**処理フロー**:
1. フォームバリデーションを実行
2. 検証エラーがある場合は、エラーメッセージを表示して処理を中断
3. APIリクエスト送信: `POST /api/todos`
4. リクエストボディ: `{ title, url, status, tags, priority, memo }`
5. レスポンス待機中はローディングインジケーターを表示
6. 成功時: やりたいこと一覧を更新、フォームを閉じる
7. 失敗時: エラーメッセージを表示

**遷移先**: やりたいこと一覧（更新）

**エラーハンドリング**:
- バリデーションエラー: 各入力欄にエラーメッセージを表示
- ネットワークエラー: 「通信エラーが発生しました。再度お試しください」を表示
- サーバーエラー: 「システムエラーが発生しました。しばらくしてから再度お試しください」を表示

#### 20_20_01_act04: 詳細表示

**アクションID**: `20_20_01_act04`  
**アクション名**: 詳細表示  
**トリガー**: タイトルクリック

**処理フロー**:
1. タイトルをクリック
2. モーダルダイアログで詳細・編集フォームを表示
3. 既存のデータがフォームに表示される

**遷移先**: 詳細・編集ダイアログ表示（モーダル）

#### 20_20_01_act05: 更新

**アクションID**: `20_20_01_act05`  
**アクション名**: 更新  
**トリガー**: 更新ボタンクリック

**処理フロー**:
1. フォームバリデーションを実行
2. 検証エラーがある場合は、エラーメッセージを表示して処理を中断
3. APIリクエスト送信: `PUT /api/todos/:id`
4. リクエストボディ: `{ title, url, status, tags, priority, memo }`
5. レスポンス待機中はローディングインジケーターを表示
6. 成功時: やりたいこと一覧を更新、フォームを閉じる
7. 失敗時: エラーメッセージを表示

**遷移先**: やりたいこと一覧（更新）

**エラーハンドリング**:
- バリデーションエラー: 各入力欄にエラーメッセージを表示
- ネットワークエラー: 「通信エラーが発生しました。再度お試しください」を表示
- サーバーエラー: 「システムエラーが発生しました。しばらくしてから再度お試しください」を表示

## 6. 画面遷移

### 6.1 遷移元

| 遷移元画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| ダッシュボード（ホーム） | サイドバーで「やりたいこと」を選択 | サイドバーのメニューから遷移 |

### 6.2 遷移先

| 遷移先画面 | 遷移条件 | 備考 |
|-----------|---------|------|
| ダッシュボード（ホーム） | サイドバーで「ホーム」を選択、または「マイアプリ」をクリック | サイドバーまたはヘッダーから遷移 |
| 新規登録フォーム | 新規登録ボタンクリック | モーダルダイアログ |
| 詳細・編集ダイアログ | タイトルクリック | モーダルダイアログ |

## 7. API仕様

### 7.1 やりたいこと一覧取得API

- **エンドポイント**: `GET /api/todos`
- **認証**: 必要（JWTトークン）
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "success": true,
    "todos": [
      {
        "id": 1,
        "title": "React公式ドキュメントを読む",
        "url": "https://example.com/task1",
        "status": "進行中",
        "registeredDate": "2024-01-15",
        "updatedDate": "2024-01-20",
        "tags": ["仕事", "緊急"],
        "priority": "高",
        "memo": "Hooksの章を重点的に読む"
      }
    ]
  }
  ```

### 7.2 やりたいこと新規登録API

- **エンドポイント**: `POST /api/todos`
- **認証**: 必要（JWTトークン）
- **リクエストボディ**:
  ```json
  {
    "title": "React公式ドキュメントを読む",
    "url": "https://example.com/task1",
    "status": "未着手",
    "tags": ["仕事", "緊急"],
    "priority": "高",
    "memo": "Hooksの章を重点的に読む"
  }
  ```
- **レスポンス（成功）**: `201 Created`
  ```json
  {
    "success": true,
    "todo": {
      "id": 1,
      "title": "React公式ドキュメントを読む",
      "url": "https://example.com/task1",
      "status": "未着手",
      "registeredDate": "2024-01-15",
      "updatedDate": "2024-01-15",
      "tags": ["仕事", "緊急"],
      "priority": "高",
      "memo": "Hooksの章を重点的に読む"
    }
  }
  ```

### 7.3 やりたいこと更新API

- **エンドポイント**: `PUT /api/todos/:id`
- **認証**: 必要（JWTトークン）
- **リクエストボディ**:
  ```json
  {
    "title": "React公式ドキュメントを読む",
    "url": "https://example.com/task1",
    "status": "進行中",
    "tags": ["仕事", "緊急"],
    "priority": "高",
    "memo": "Hooksの章を重点的に読む"
  }
  ```
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "success": true,
    "todo": {
      "id": 1,
      "title": "React公式ドキュメントを読む",
      "url": "https://example.com/task1",
      "status": "進行中",
      "registeredDate": "2024-01-15",
      "updatedDate": "2024-01-20",
      "tags": ["仕事", "緊急"],
      "priority": "高",
      "memo": "Hooksの章を重点的に読む"
    }
  }
  ```

### 7.4 やりたいこと削除API（オプション）

- **エンドポイント**: `DELETE /api/todos/:id`
- **認証**: 必要（JWTトークン）
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "success": true,
    "message": "削除しました"
  }
  ```

## 8. データモデル

### 8.1 やりたいこと（todos）テーブル

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 一意のID |
| user_id | INT | FOREIGN KEY, NOT NULL | ユーザーID |
| title | VARCHAR(255) | NOT NULL | タイトル |
| url | VARCHAR(500) | NOT NULL | 関連URL |
| status | ENUM('未着手', '進行中', '完了') | NOT NULL, DEFAULT '未着手' | ステータス |
| registered_date | DATE | NOT NULL | 登録日 |
| updated_date | DATE | NOT NULL | 更新日 |
| priority | ENUM('高', '中', '低') | NOT NULL, DEFAULT '中' | 優先度 |
| memo | TEXT | NULL | メモ |
| created_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

### 8.2 タグ（tags）テーブル

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 一意のID |
| name | VARCHAR(50) | NOT NULL, UNIQUE | タグ名 |

### 8.3 やりたいこと-タグ関連（todo_tags）テーブル

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| todo_id | INT | FOREIGN KEY, NOT NULL | やりたいことID |
| tag_id | INT | FOREIGN KEY, NOT NULL | タグID |
| PRIMARY KEY | (todo_id, tag_id) | - | 複合主キー |

## 9. アクセシビリティ要件

- すべての入力欄に適切なラベルを設定
- エラーメッセージは適切なARIA属性で関連付け
- キーボード操作で全機能にアクセス可能
- フォーカス順序が論理的
- テーブルは適切なヘッダーと関連付け

## 10. 備考

- 未ログインの状態でこのページにアクセスした場合、自動的にログインページにリダイレクト
- タグはカンマ区切りで入力し、複数のタグを設定可能
- URLは外部リンクとして表示し、新しいタブで開く
- ステータスと優先度はバッジ形式で表示し、色分けする

