# Dockerfile 説明書

## 概要

このDockerfileは、バックエンドAPIサーバーをDockerコンテナとして実行するための設定ファイルです。

## 各行の説明

### `FROM node:18-alpine`
- **意味**: ベースイメージを指定
- **詳細**: 
  - `node:18` - Node.js 18がインストールされた公式イメージ
  - `alpine` - 軽量なLinuxディストリビューション（サイズが小さい）
- **なぜ使うか**: Node.jsアプリケーションを実行するために必要

### `WORKDIR /app`
- **意味**: コンテナ内の作業ディレクトリを設定
- **詳細**: 以降のコマンドはすべて `/app` ディレクトリで実行される
- **なぜ使うか**: ファイルのパスを簡潔にし、整理するため

### `COPY package*.json ./`
- **意味**: パッケージ管理ファイルをコンテナにコピー
- **詳細**: 
  - `package.json` と `package-lock.json` をコピー
  - `./` は `WORKDIR` で指定した `/app` を指す
- **なぜ先にコピーするか**: Dockerのレイヤーキャッシュを活用するため
  - 依存関係が変わらない限り、この後の `npm install` をキャッシュから実行できる

### `RUN npm install`
- **意味**: 依存関係（パッケージ）をインストール
- **詳細**: `package.json` に記載されたパッケージをインストール
- **なぜここで実行するか**: アプリケーションコードより先に依存関係をインストールすることで、コード変更時もキャッシュを活用できる

### `COPY . .`
- **意味**: アプリケーションコードをコンテナにコピー
- **詳細**: 
  - 最初の `.` - ホスト（ローカル）の現在のディレクトリ（`backend/`）
  - 2番目の `.` - コンテナ内の現在のディレクトリ（`/app`）
- **注意**: `.dockerignore` で除外されたファイルはコピーされない

### `EXPOSE 3004`
- **意味**: コンテナが使用するポートを宣言
- **詳細**: ポート3004を使用することを明示
- **注意**: 実際にポートを公開するには、`docker-compose.yml` で `ports: - "3004:3004"` を設定する必要がある

### `CMD ["npm", "run", "dev"]`
- **意味**: コンテナ起動時に実行するコマンド
- **詳細**: `npm run dev` を実行（開発モードでサーバーを起動）
- **なぜ使うか**: 開発中はホットリロード（コード変更の自動反映）が有効になる

## 使い方

### 1. ビルド
```bash
docker build -t login-app-backend ./backend
```

### 2. 実行
```bash
docker run -p 3004:3004 login-app-backend
```

### 3. Docker Composeで使用
`docker-compose.yml` で以下のように使用されます：
```yaml
backend:
  build:
    context: ./backend
    dockerfile: Dockerfile
```

## レイヤーキャッシュの仕組み

Dockerfileは上から順に実行され、各行が1つのレイヤーになります。
変更の少ない行（例: `package.json`）を先に配置することで、コード変更時も依存関係のインストールをスキップできます。

## 開発環境での動作

- `volumes: - ./backend:/app` により、ローカルのコード変更がコンテナ内に反映される
- `npm run dev` により、コード変更が自動的に検知され、サーバーが再起動される

